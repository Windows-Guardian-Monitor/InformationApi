@page "/create_user"
@using ClientServer.Client.Operators.Contracts
@inject ICustomSnackbarOperator _snackbarOperator

<AuthorizeView Roles="Administrator" Context="authenticationContext">
	<Authorized>
		<ClientServer.Client.Pages.Components.CustomSnackbar SnackbarOperator="_snackbarOperator" />
		<EditForm Model="userModel" OnValidSubmit="HandleValidSubmit">
			<div class="form-group">
				<label for="username">Nome de usuário</label>
				<InputText id="username" class="form-control" @bind-Value="userModel.Username" />
				<ValidationMessage For="@(() => userModel.Username)" class="text-danger" />
			</div>

			<div class="form-group">
				<label for="email">E-mail</label>
				<InputText id="email" type="email" class="form-control" @bind-Value="userModel.Email" />
				<ValidationMessage For="@(() => userModel.Email)" class="text-danger" />
			</div>

			<div class="form-group">
				<label for="password">Senha</label>
				<InputText id="password" type="password" class="form-control" @bind-Value="userModel.Password" />
				<ValidationMessage For="@(() => userModel.Password)" class="text-danger" />
			</div>

			<div class="form-check">
				<InputCheckbox id="isAdmin" class="form-check-input" @bind-Value="userModel.IsAdmin" />
				<label class="form-check-label" for="isAdmin">É administrador</label>
			</div>

			<button type="submit" class="btn btn-primary mt-3">Register</button>
		</EditForm>
	</Authorized>
	<NotAuthorized>
		<ClientServer.Client.Pages.Components.AccessDenied />
	</NotAuthorized>
</AuthorizeView>

@code {
	private UserModel userModel = new UserModel();

	private async Task HandleValidSubmit()
	{
		try
		{
			_snackbarOperator.Hide();

			if (
				string.IsNullOrEmpty(userModel.Username) ||
				string.IsNullOrEmpty(userModel.Email) ||
				string.IsNullOrEmpty(userModel.Password))
			{
				_snackbarOperator.ShowWarningMessage("Por favor preencha todos os campos do cadastro!");
				return;
			}

		}
		catch (Exception e)
		{
			_snackbarOperator.ShowErrorMessage(e.Message);
		}
	}

	public class UserModel
	{
		public string Username { get; set; }
		public string Email { get; set; }
		public string Password { get; set; }
		public bool IsAdmin { get; set; }
	}
}
